
import teradata
import pandas as pd

#Queries to get data from Teradata
RES_MASKED_ = "select Weather_Reading_Dt ,  avgRelativeHumidity , avgWindSpeed,  maxTemperature,  tenYrNormalMaxTemperature, Consumption_Usage, NoOfCustomers from (select Weather_Reading_Dt , avg(relativeHumidity) as avgRelativeHumidity , avg(windSpeed) as avgWindSpeed, max(temperature) as maxTemperature, avg(tenYrNormalMaxTemperature) as tenYrNormalMaxTemperature from  TABLE(Masked) A INNER JOIN  (SELECT  CAST( Reading_Dttm AS DATE) AS Reading_Dttm, Weather_Reading_Meas AS tenYrNormalMaxTemperature  FROM  TABLE2(Masked) where Weather_Reading_Interval = 'DAILY' AND  Weather_Reading_Type_Cd IN ('tenYrNormalMaxTemperature') and CAST( Reading_Dttm AS DATE) between '2017-05-01' and CURRENT_DATE AND Weather_site_id = 'KOKC') B on A.Weather_Reading_Dt = B.Reading_Dttm where  A.weather_reading_dt between '2017-05-01' and CURRENT_DATE AND A.STATION_ID = 'KOKC' AND A.OBSERVE_TYPE = 'OBSERVED' group by Weather_Reading_Dt) Z INNER JOIN (SELECT METER_READING_DATE ,SUM(Consumption_Usage) as Consumption_Usage, count(distinct a.CONTRACT_ACCOUNT_NUMBER) AS NoOfCustomers  FROM  TABLE3(Masked) a inner join TABLE4(Masked) b on  a.CONTRACT_ACCOUNT_NUMBER =  b.CONTRACT_ACCOUNT_NUMBER  WHERE meter_reading_date between '2017-05-01' and CURRENT_DATE AND RATE_CATEGORY_CODE = 'OK131-5' AND SUBSTRING(ACCOUNT_DETERMINATION_CODE FROM 1 FOR 1) = 'R'  Group by a.METER_READING_DATE ) Y on Z.Weather_Reading_Dt = Y.METER_READING_DATE order by Weather_Reading_Dt;"
RES_TimeOfUse = "select Weather_Reading_Dt ,  avgRelativeHumidity , avgWindSpeed,  maxTemperature,  tenYrNormalMaxTemperature, Consumption_Usage, NoOfCustomers from (select Weather_Reading_Dt , avg(relativeHumidity) as avgRelativeHumidity , avg(windSpeed) as avgWindSpeed, max(temperature) as maxTemperature, avg(tenYrNormalMaxTemperature) as tenYrNormalMaxTemperature from  TABLE(Masked) A INNER JOIN  (SELECT  CAST( Reading_Dttm AS DATE) AS Reading_Dttm, Weather_Reading_Meas AS tenYrNormalMaxTemperature  FROM  TABLE2(Masked) where Weather_Reading_Interval = 'DAILY' AND  Weather_Reading_Type_Cd IN ('tenYrNormalMaxTemperature') and CAST( Reading_Dttm AS DATE) between '2017-05-01' and CURRENT_DATE AND Weather_site_id = 'KOKC') B on A.Weather_Reading_Dt = B.Reading_Dttm where  A.weather_reading_dt between '2017-05-01' and CURRENT_DATE AND A.STATION_ID = 'KOKC' AND A.OBSERVE_TYPE = 'OBSERVED' group by Weather_Reading_Dt) Z INNER JOIN (SELECT METER_READING_DATE ,SUM(Consumption_Usage) as Consumption_Usage, count(distinct a.CONTRACT_ACCOUNT_NUMBER) AS NoOfCustomers  FROM  TABLE3(Masked) a inner join TABLE4(Masked) b on  a.CONTRACT_ACCOUNT_NUMBER =  b.CONTRACT_ACCOUNT_NUMBER  WHERE meter_reading_date between '2017-05-01' and CURRENT_DATE AND RATE_CATEGORY_CODE in ('OK13T-5','OK13TB-5') AND SUBSTRING(ACCOUNT_DETERMINATION_CODE FROM 1 FOR 1) = 'R' Group by a.METER_READING_DATE ) Y on Z.Weather_Reading_Dt = Y.METER_READING_DATE order by Weather_Reading_Dt;"
RES_VariablePeakPricing = "select Weather_Reading_Dt ,  avgRelativeHumidity , avgWindSpeed,  maxTemperature,  tenYrNormalMaxTemperature, Consumption_Usage, NoOfCustomers from (select Weather_Reading_Dt , avg(relativeHumidity) as avgRelativeHumidity , avg(windSpeed) as avgWindSpeed, max(temperature) as maxTemperature, avg(tenYrNormalMaxTemperature) as tenYrNormalMaxTemperature from  TABLE(Masked) A INNER JOIN  (SELECT  CAST( Reading_Dttm AS DATE) AS Reading_Dttm, Weather_Reading_Meas AS tenYrNormalMaxTemperature  FROM  TABLE2(Masked) where Weather_Reading_Interval = 'DAILY' AND  Weather_Reading_Type_Cd IN ('tenYrNormalMaxTemperature') and CAST( Reading_Dttm AS DATE) between '2017-05-01' and CURRENT_DATE AND Weather_site_id = 'KOKC') B on A.Weather_Reading_Dt = B.Reading_Dttm where  A.weather_reading_dt between '2017-05-01' and CURRENT_DATE AND A.STATION_ID = 'KOKC' AND A.OBSERVE_TYPE = 'OBSERVED' group by Weather_Reading_Dt) Z INNER JOIN (SELECT METER_READING_DATE ,SUM(Consumption_Usage) as Consumption_Usage, count(distinct a.CONTRACT_ACCOUNT_NUMBER) AS NoOfCustomers  FROM  TABLE3(Masked) a inner join TABLE4(Masked) b on  a.CONTRACT_ACCOUNT_NUMBER =  b.CONTRACT_ACCOUNT_NUMBER  WHERE meter_reading_date between '2017-05-01' and CURRENT_DATE AND RATE_CATEGORY_CODE in ('OK13V-5','OK13VB-5') AND SUBSTRING(ACCOUNT_DETERMINATION_CODE FROM 1 FOR 1) = 'R' Group by a.METER_READING_DATE ) Y on Z.Weather_Reading_Dt = Y.METER_READING_DATE order by Weather_Reading_Dt;"
RES_GuaranteedFlatBill = "select Weather_Reading_Dt ,  avgRelativeHumidity , avgWindSpeed,  maxTemperature,  tenYrNormalMaxTemperature, Consumption_Usage, NoOfCustomers from (select Weather_Reading_Dt , avg(relativeHumidity) as avgRelativeHumidity , avg(windSpeed) as avgWindSpeed, max(temperature) as maxTemperature, avg(tenYrNormalMaxTemperature) as tenYrNormalMaxTemperature from  TABLE(Masked) A INNER JOIN  (SELECT  CAST( Reading_Dttm AS DATE) AS Reading_Dttm, Weather_Reading_Meas AS tenYrNormalMaxTemperature  FROM  TABLE2(Masked) where Weather_Reading_Interval = 'DAILY' AND  Weather_Reading_Type_Cd IN ('tenYrNormalMaxTemperature') and CAST( Reading_Dttm AS DATE) between '2017-05-01' and CURRENT_DATE AND Weather_site_id = 'KOKC') B on A.Weather_Reading_Dt = B.Reading_Dttm where  A.weather_reading_dt between '2017-05-01' and CURRENT_DATE AND A.STATION_ID = 'KOKC' AND A.OBSERVE_TYPE = 'OBSERVED' group by Weather_Reading_Dt) Z INNER JOIN (SELECT METER_READING_DATE ,SUM(Consumption_Usage) as Consumption_Usage, count(distinct a.CONTRACT_ACCOUNT_NUMBER) AS NoOfCustomers  FROM  TABLE3(Masked) a inner join TABLE4(Masked) b on  a.CONTRACT_ACCOUNT_NUMBER =  b.CONTRACT_ACCOUNT_NUMBER  WHERE meter_reading_date between '2017-05-01' and CURRENT_DATE AND RATE_CATEGORY_CODE in ('OK13G-5') AND SUBSTRING(ACCOUNT_DETERMINATION_CODE FROM 1 FOR 1) = 'R' Group by a.METER_READING_DATE ) Y on Z.Weather_Reading_Dt = Y.METER_READING_DATE order by Weather_Reading_Dt;"
RESIDENTIAL = "select Weather_Reading_Dt ,  avgRelativeHumidity , avgWindSpeed,  maxTemperature,  tenYrNormalMaxTemperature, Consumption_Usage, NoOfCustomers from (select Weather_Reading_Dt , avg(relativeHumidity) as avgRelativeHumidity , avg(windSpeed) as avgWindSpeed, max(temperature) as maxTemperature, avg(tenYrNormalMaxTemperature) as tenYrNormalMaxTemperature from  TABLE(Masked) A INNER JOIN  (SELECT  CAST( Reading_Dttm AS DATE) AS Reading_Dttm, Weather_Reading_Meas AS tenYrNormalMaxTemperature  FROM  TABLE2(Masked) where Weather_Reading_Interval = 'DAILY' AND  Weather_Reading_Type_Cd IN ('tenYrNormalMaxTemperature') and CAST( Reading_Dttm AS DATE) between '2017-05-01' and CURRENT_DATE AND Weather_site_id = 'KOKC') B on A.Weather_Reading_Dt = B.Reading_Dttm where  A.weather_reading_dt between '2017-05-01' and CURRENT_DATE AND A.STATION_ID = 'KOKC' AND A.OBSERVE_TYPE = 'OBSERVED' group by Weather_Reading_Dt) Z INNER JOIN (SELECT METER_READING_DATE ,SUM(Consumption_Usage) as Consumption_Usage, count(distinct a.CONTRACT_ACCOUNT_NUMBER) AS NoOfCustomers  FROM  TABLE3(Masked) a inner join TABLE4(Masked) b on  a.CONTRACT_ACCOUNT_NUMBER =  b.CONTRACT_ACCOUNT_NUMBER  WHERE meter_reading_date between '2017-05-01' and CURRENT_DATE AND SUBSTRING(ACCOUNT_DETERMINATION_CODE FROM 1 FOR 1) = 'R'  Group by a.METER_READING_DATE ) Y on Z.Weather_Reading_Dt = Y.METER_READING_DATE order by Weather_Reading_Dt;"
COMMERCIAL = "select Weather_Reading_Dt ,  avgRelativeHumidity , avgWindSpeed,  maxTemperature,  tenYrNormalMaxTemperature, Consumption_Usage, NoOfCustomers from (select Weather_Reading_Dt , avg(relativeHumidity) as avgRelativeHumidity , avg(windSpeed) as avgWindSpeed, max(temperature) as maxTemperature, avg(tenYrNormalMaxTemperature) as tenYrNormalMaxTemperature from  TABLE(Masked) A INNER JOIN  (SELECT  CAST( Reading_Dttm AS DATE) AS Reading_Dttm, Weather_Reading_Meas AS tenYrNormalMaxTemperature  FROM  TABLE2(Masked) where Weather_Reading_Interval = 'DAILY' AND  Weather_Reading_Type_Cd IN ('tenYrNormalMaxTemperature') and CAST( Reading_Dttm AS DATE) between '2017-05-01' and CURRENT_DATE AND Weather_site_id = 'KOKC') B on A.Weather_Reading_Dt = B.Reading_Dttm where  A.weather_reading_dt between '2017-05-01' and CURRENT_DATE AND A.STATION_ID = 'KOKC' AND A.OBSERVE_TYPE = 'OBSERVED' group by Weather_Reading_Dt) Z INNER JOIN (SELECT METER_READING_DATE ,SUM(Consumption_Usage) as Consumption_Usage, count(distinct a.CONTRACT_ACCOUNT_NUMBER) AS NoOfCustomers  FROM  TABLE3(Masked) a inner join TABLE4(Masked) b on  a.CONTRACT_ACCOUNT_NUMBER =  b.CONTRACT_ACCOUNT_NUMBER  WHERE meter_reading_date between '2017-05-01' and CURRENT_DATE AND SUBSTRING(ACCOUNT_DETERMINATION_CODE FROM 1 FOR 1) = 'C' Group by a.METER_READING_DATE ) Y on Z.Weather_Reading_Dt = Y.METER_READING_DATE order by Weather_Reading_Dt;"
COM_TimeOfUse = "select Weather_Reading_Dt ,  avgRelativeHumidity , avgWindSpeed,  maxTemperature,  tenYrNormalMaxTemperature, Consumption_Usage, NoOfCustomers from (select Weather_Reading_Dt , avg(relativeHumidity) as avgRelativeHumidity , avg(windSpeed) as avgWindSpeed, max(temperature) as maxTemperature, avg(tenYrNormalMaxTemperature) as tenYrNormalMaxTemperature from  TABLE(Masked) A INNER JOIN  (SELECT  CAST( Reading_Dttm AS DATE) AS Reading_Dttm, Weather_Reading_Meas AS tenYrNormalMaxTemperature  FROM  TABLE2(Masked) where Weather_Reading_Interval = 'DAILY' AND  Weather_Reading_Type_Cd IN ('tenYrNormalMaxTemperature') and CAST( Reading_Dttm AS DATE) between '2017-05-01' and CURRENT_DATE AND Weather_site_id = 'KOKC') B on A.Weather_Reading_Dt = B.Reading_Dttm where  A.weather_reading_dt between '2017-05-01' and CURRENT_DATE AND A.STATION_ID = 'KOKC' AND A.OBSERVE_TYPE = 'OBSERVED' group by Weather_Reading_Dt) Z INNER JOIN (SELECT METER_READING_DATE ,SUM(Consumption_Usage) as Consumption_Usage, count(distinct a.CONTRACT_ACCOUNT_NUMBER) AS NoOfCustomers  FROM  TABLE3(Masked) a inner join TABLE4(Masked) b on  a.CONTRACT_ACCOUNT_NUMBER =  b.CONTRACT_ACCOUNT_NUMBER  WHERE meter_reading_date between '2017-05-01' and CURRENT_DATE AND RATE_CATEGORY_CODE in ( 'OK06T-3','OK06T-5','OK06TB-5') AND SUBSTRING(ACCOUNT_DETERMINATION_CODE FROM 1 FOR 1) = 'C' Group by a.METER_READING_DATE ) Y on Z.Weather_Reading_Dt = Y.METER_READING_DATE order by Weather_Reading_Dt;"
COM_Standard = "select Weather_Reading_Dt ,  avgRelativeHumidity , avgWindSpeed,  maxTemperature,  tenYrNormalMaxTemperature, Consumption_Usage, NoOfCustomers from (select Weather_Reading_Dt , avg(relativeHumidity) as avgRelativeHumidity , avg(windSpeed) as avgWindSpeed, max(temperature) as maxTemperature, avg(tenYrNormalMaxTemperature) as tenYrNormalMaxTemperature from  TABLE(Masked) A INNER JOIN  (SELECT  CAST( Reading_Dttm AS DATE) AS Reading_Dttm, Weather_Reading_Meas AS tenYrNormalMaxTemperature  FROM  TABLE2(Masked) where Weather_Reading_Interval = 'DAILY' AND  Weather_Reading_Type_Cd IN ('tenYrNormalMaxTemperature') and CAST( Reading_Dttm AS DATE) between '2017-05-01' and CURRENT_DATE AND Weather_site_id = 'KOKC') B on A.Weather_Reading_Dt = B.Reading_Dttm where  A.weather_reading_dt between '2017-05-01' and CURRENT_DATE AND A.STATION_ID = 'KOKC' AND A.OBSERVE_TYPE = 'OBSERVED' group by Weather_Reading_Dt) Z INNER JOIN (SELECT METER_READING_DATE ,SUM(Consumption_Usage) as Consumption_Usage, count(distinct a.CONTRACT_ACCOUNT_NUMBER) AS NoOfCustomers  FROM  TABLE3(Masked) a inner join TABLE4(Masked) b on  a.CONTRACT_ACCOUNT_NUMBER =  b.CONTRACT_ACCOUNT_NUMBER  WHERE meter_reading_date between '2017-05-01' and CURRENT_DATE AND RATE_CATEGORY_CODE in ( 'OK06-3','OK06-4','OK06-5') AND SUBSTRING(ACCOUNT_DETERMINATION_CODE FROM 1 FOR 1) = 'C' Group by a.METER_READING_DATE ) Y on Z.Weather_Reading_Dt = Y.METER_READING_DATE order by Weather_Reading_Dt;"
COM_VariablePeakPricing = "select Weather_Reading_Dt ,  avgRelativeHumidity , avgWindSpeed,  maxTemperature,  tenYrNormalMaxTemperature, Consumption_Usage, NoOfCustomers from (select Weather_Reading_Dt , avg(relativeHumidity) as avgRelativeHumidity , avg(windSpeed) as avgWindSpeed, max(temperature) as maxTemperature, avg(tenYrNormalMaxTemperature) as tenYrNormalMaxTemperature from  TABLE(Masked) A INNER JOIN  (SELECT  CAST( Reading_Dttm AS DATE) AS Reading_Dttm, Weather_Reading_Meas AS tenYrNormalMaxTemperature  FROM  TABLE2(Masked) where Weather_Reading_Interval = 'DAILY' AND  Weather_Reading_Type_Cd IN ('tenYrNormalMaxTemperature') and CAST( Reading_Dttm AS DATE) between '2017-05-01' and CURRENT_DATE AND Weather_site_id = 'KOKC') B on A.Weather_Reading_Dt = B.Reading_Dttm where  A.weather_reading_dt between '2017-05-01' and CURRENT_DATE AND A.STATION_ID = 'KOKC' AND A.OBSERVE_TYPE = 'OBSERVED' group by Weather_Reading_Dt) Z INNER JOIN (SELECT METER_READING_DATE ,SUM(Consumption_Usage) as Consumption_Usage, count(distinct a.CONTRACT_ACCOUNT_NUMBER) AS NoOfCustomers  FROM  TABLE3(Masked) a inner join TABLE4(Masked) b on  a.CONTRACT_ACCOUNT_NUMBER =  b.CONTRACT_ACCOUNT_NUMBER  WHERE meter_reading_date between '2017-05-01' and CURRENT_DATE AND RATE_CATEGORY_CODE in ('OK06V-3','OK06V-5','OK06VB-5') AND SUBSTRING(ACCOUNT_DETERMINATION_CODE FROM 1 FOR 1) = 'C' Group by a.METER_READING_DATE ) Y on Z.Weather_Reading_Dt = Y.METER_READING_DATE order by Weather_Reading_Dt;"
COM_Residential = "select Weather_Reading_Dt ,  avgRelativeHumidity , avgWindSpeed,  maxTemperature,  tenYrNormalMaxTemperature, Consumption_Usage, NoOfCustomers from (select Weather_Reading_Dt , avg(relativeHumidity) as avgRelativeHumidity , avg(windSpeed) as avgWindSpeed, max(temperature) as maxTemperature, avg(tenYrNormalMaxTemperature) as tenYrNormalMaxTemperature from  TABLE(Masked) A INNER JOIN  (SELECT  CAST( Reading_Dttm AS DATE) AS Reading_Dttm, Weather_Reading_Meas AS tenYrNormalMaxTemperature  FROM  TABLE2(Masked) where Weather_Reading_Interval = 'DAILY' AND  Weather_Reading_Type_Cd IN ('tenYrNormalMaxTemperature') and CAST( Reading_Dttm AS DATE) between '2017-05-01' and CURRENT_DATE AND Weather_site_id = 'KOKC') B on A.Weather_Reading_Dt = B.Reading_Dttm where  A.weather_reading_dt between '2017-05-01' and CURRENT_DATE AND A.STATION_ID = 'KOKC' AND A.OBSERVE_TYPE = 'OBSERVED' group by Weather_Reading_Dt) Z INNER JOIN (SELECT METER_READING_DATE ,SUM(Consumption_Usage) as Consumption_Usage, count(distinct a.CONTRACT_ACCOUNT_NUMBER) AS NoOfCustomers  FROM  TABLE3(Masked) a inner join TABLE4(Masked) b on  a.CONTRACT_ACCOUNT_NUMBER =  b.CONTRACT_ACCOUNT_NUMBER  WHERE meter_reading_date between '2017-05-01' and CURRENT_DATE AND RATE_CATEGORY_CODE in ( 'OK131-5','OK13G-5','OK13V-5') AND SUBSTRING(ACCOUNT_DETERMINATION_CODE FROM 1 FOR 1) = 'C' Group by a.METER_READING_DATE ) Y on Z.Weather_Reading_Dt = Y.METER_READING_DATE order by Weather_Reading_Dt;"
OIL = "select Weather_Reading_Dt ,  avgRelativeHumidity , avgWindSpeed,  maxTemperature,  tenYrNormalMaxTemperature, Consumption_Usage, NoOfCustomers from (select Weather_Reading_Dt , avg(relativeHumidity) as avgRelativeHumidity , avg(windSpeed) as avgWindSpeed, max(temperature) as maxTemperature, avg(tenYrNormalMaxTemperature) as tenYrNormalMaxTemperature from  TABLE(Masked) A INNER JOIN  (SELECT  CAST( Reading_Dttm AS DATE) AS Reading_Dttm, Weather_Reading_Meas AS tenYrNormalMaxTemperature  FROM  TABLE2(Masked) where Weather_Reading_Interval = 'DAILY' AND  Weather_Reading_Type_Cd IN ('tenYrNormalMaxTemperature') and CAST( Reading_Dttm AS DATE) between '2017-05-01' and CURRENT_DATE AND Weather_site_id = 'KOKC') B on A.Weather_Reading_Dt = B.Reading_Dttm where  A.weather_reading_dt between '2017-05-01' and CURRENT_DATE AND A.STATION_ID = 'KOKC' AND A.OBSERVE_TYPE = 'OBSERVED' group by Weather_Reading_Dt) Z INNER JOIN (SELECT METER_READING_DATE ,SUM(Consumption_Usage) as Consumption_Usage, count(distinct a.CONTRACT_ACCOUNT_NUMBER) AS NoOfCustomers  FROM  TABLE3(Masked) a inner join TABLE4(Masked) b on  a.CONTRACT_ACCOUNT_NUMBER =  b.CONTRACT_ACCOUNT_NUMBER  WHERE meter_reading_date between '2017-05-01' and CURRENT_DATE AND SUBSTRING(ACCOUNT_DETERMINATION_CODE FROM 1 FOR 1) = 'O' Group by a.METER_READING_DATE ) Y on Z.Weather_Reading_Dt = Y.METER_READING_DATE order by Weather_Reading_Dt;"
Industrial = "select Weather_Reading_Dt ,  avgRelativeHumidity , avgWindSpeed,  maxTemperature,  tenYrNormalMaxTemperature, Consumption_Usage, NoOfCustomers from (select Weather_Reading_Dt , avg(relativeHumidity) as avgRelativeHumidity , avg(windSpeed) as avgWindSpeed, max(temperature) as maxTemperature, avg(tenYrNormalMaxTemperature) as tenYrNormalMaxTemperature from  TABLE(Masked) A INNER JOIN  (SELECT  CAST( Reading_Dttm AS DATE) AS Reading_Dttm, Weather_Reading_Meas AS tenYrNormalMaxTemperature  FROM  TABLE2(Masked) where Weather_Reading_Interval = 'DAILY' AND  Weather_Reading_Type_Cd IN ('tenYrNormalMaxTemperature') and CAST( Reading_Dttm AS DATE) between '2017-05-01' and CURRENT_DATE AND Weather_site_id = 'KOKC') B on A.Weather_Reading_Dt = B.Reading_Dttm where  A.weather_reading_dt between '2017-05-01' and CURRENT_DATE AND A.STATION_ID = 'KOKC' AND A.OBSERVE_TYPE = 'OBSERVED' group by Weather_Reading_Dt) Z INNER JOIN (SELECT METER_READING_DATE ,SUM(Consumption_Usage) as Consumption_Usage, count(distinct a.CONTRACT_ACCOUNT_NUMBER) AS NoOfCustomers  FROM  TABLE3(Masked) a inner join TABLE4(Masked) b on  a.CONTRACT_ACCOUNT_NUMBER =  b.CONTRACT_ACCOUNT_NUMBER  WHERE meter_reading_date between '2017-05-01' and CURRENT_DATE AND SUBSTRING(ACCOUNT_DETERMINATION_CODE FROM 1 FOR 1) = 'I' Group by a.METER_READING_DATE ) Y on Z.Weather_Reading_Dt = Y.METER_READING_DATE order by Weather_Reading_Dt;"
Public_Authority = "select Weather_Reading_Dt ,  avgRelativeHumidity , avgWindSpeed,  maxTemperature,  tenYrNormalMaxTemperature, Consumption_Usage, NoOfCustomers from (select Weather_Reading_Dt , avg(relativeHumidity) as avgRelativeHumidity , avg(windSpeed) as avgWindSpeed, max(temperature) as maxTemperature, avg(tenYrNormalMaxTemperature) as tenYrNormalMaxTemperature from  TABLE(Masked) A INNER JOIN  (SELECT  CAST( Reading_Dttm AS DATE) AS Reading_Dttm, Weather_Reading_Meas AS tenYrNormalMaxTemperature  FROM  TABLE2(Masked) where Weather_Reading_Interval = 'DAILY' AND  Weather_Reading_Type_Cd IN ('tenYrNormalMaxTemperature') and CAST( Reading_Dttm AS DATE) between '2017-05-01' and CURRENT_DATE AND Weather_site_id = 'KOKC') B on A.Weather_Reading_Dt = B.Reading_Dttm where  A.weather_reading_dt between '2017-05-01' and CURRENT_DATE AND A.STATION_ID = 'KOKC' AND A.OBSERVE_TYPE = 'OBSERVED' group by Weather_Reading_Dt) Z INNER JOIN (SELECT METER_READING_DATE ,SUM(Consumption_Usage) as Consumption_Usage, count(distinct a.CONTRACT_ACCOUNT_NUMBER) AS NoOfCustomers  FROM  TABLE3(Masked) a inner join TABLE4(Masked) b on  a.CONTRACT_ACCOUNT_NUMBER =  b.CONTRACT_ACCOUNT_NUMBER  WHERE meter_reading_date between '2017-05-01' and CURRENT_DATE AND SUBSTRING(ACCOUNT_DETERMINATION_CODE FROM 1 FOR 1) = 'P' Group by a.METER_READING_DATE ) Y on Z.Weather_Reading_Dt = Y.METER_READING_DATE order by Weather_Reading_Dt;"

dictionary = {"RESIDENTIAL":RESIDENTIAL,"RES_MASKED_":RES_MASKED_,"RES_TimeOfUse":RES_TimeOfUse,"RES_VariablePeakPricing":RES_VariablePeakPricing, "RES_GuaranteedFlatBill":RES_GuaranteedFlatBill,"COMMERCIAL":COMMERCIAL, "COM_TimeOfUse":COM_TimeOfUse,"COM_Standard": COM_Standard,"COM_VariablePeakPricing":COM_VariablePeakPricing, "COM_Residential":COM_Residential, "OIL":OIL,"Industrial":Industrial, "Public_Authority":Public_Authority }
writer = pd.ExcelWriter('H:****\\Usage&_weather_SQL_Data_AllWeatherParameters.xlsx', engine='xlsxwriter')

#Connecting to Teradata Database
udaExec = teradata.UdaExec(appName="Automatic_DataLoad_SQL", version="1.0", logConsole=True)

with udaExec.connect(method="odbc", system="**", username="***", password="***", authentication="**") as connect:
 for key, value in dictionary.items():
     
     #Reading Queries to Dataframes
     z = pd.read_sql(value,connect)
     #Exporting Dataframes to excel
     z.to_excel(writer, sheet_name=key)
     
# Close the Pandas Excel writer and output the Excel file.
writer.save()

exit()
